# TODO
#
# - document info about paging in header
# - make sure general fields are documented
#
api:
  availability:
    description: Get availability of material at the library
    required:
      - pid
    properties:
      pid:
        description: pid of the work to order
        type: string
        example: "870970-basis:24284565"
      fields:
        descriptions: the libraries to check availability at
        type: array
        items: {type: "string"}
        example: ["700400", "710100", "710100"]
    response:
      example: {"700400":{"note": "check_local_library", "willLend": false}, "710100":{"willLend": true, "expectedDelivery": "2016-04-15"}}
  events:
    description: List of events at the library where the application is logged in
    properties:
      nids:
        description: to fetch events specified by ids
        type: array
        items: {type: "string"}
        example: ["15"]
      limit:
        description: number of events to get
        type: number
        example: 2
      offset:
        description: offset to first event to get events chronological
        type: number
        example: 2
      fields:
        description: which parts of the response to get
        type: array
        items: {type: "string"}
        example: ["nid", "title"]
    response:
      example: [{"nid": "15", "title": "Mød forfatteren: Tim Buk-Swienty", "start": "2016-05-15 08:30:00", "lead": "...", "image": "/files/775100/...", "id": "56b0687313e4eefa60ef18cd", "body": "<p>Nunc ullamcorper pulvinar pharetra. Aliquam ma..." }]
  facets:
    description: Facets of a search result
    required:
      - q
    properties:
      q:
        description: Query to find facets for. The query is expressed in CQL, see http://zing.z3950.org/cql/.
        type: string
      sort:
        example: "default"
        description: Order/ranking of results, such as "default", "rank_title", "rank_general", "acquisitionDate_ascending", "random"
        type: string
      fields:
        description: limits the facets fetched
        type: array
        items: {type: "string"}
        example: ["creator", "subject", "type"]
      limit:
        description: number of facets per type
        example: 2
    response:
      example: { "creator": [{ "term": "nordisk ministerråd", "frequency": 2708}, { "term": "nordisk råd", "frequency": 2463}], "subject": [{ "term": "danmark", "frequency": 188792}, { "term": "historie", "frequency": 19867}], "type": [{ "term": "avisartikel", "frequency": 83786}, { "term": "tidsskriftsartikel", "frequency": 77618}]}
  libraries:
    description: list/information about libraries
    properties:
      branchIds:
        description: ids of libraries to fetch, - return all libraries if omitted.
        type: array
        items: {type: "string"}
      fields:
        description: which information about the library that is needed
        type: array
        items: {type: "string"}
        example: ["branchId", "city", "longitude", "latitude"]
    response:
      example: [ {"branchId": "700401", "city": "Flensburg", "longitude": "54.4801716", "latitude": "9.0467115"}, {"branchId": "710104", "city": "København N", "longitude": "55.680887", "latitude": "12.573619"}, "..."  ]
  news:
    description: news-posts about the library
    properties:
      nids:
        description: to fetch news specified by ids
        type: array
        items: {type: "string"}
      limit:
        description: number of news to get
        type: number
      offset:
        description: offset to first news to get events chronological
        type: number
    response:
      example: [{"nid": "19", "title": "Sportsstjerner - bag facaden", "lead": "...", "image": "/files/775100/...", "id": "56b0687313e4eefa60ef18cd", "body": "<p>Nunc ullamcorper pulvinar pharetra. Aliquam ma..."}, {"nid": "40", "...": "..."}, "..."]
  order:
    description: Order a library material, or modify/remove an existing order.
    properties:
      orderId:
        description: The identifier for the order, required when updating or deleting an order. You get this from `/user`-status. Depending on the kind of order, it can take a long time from ordering, until the material with the orderId appears in the user status.
        type: string
        example: "1234"
      pids:
        description: The pids of the material to order. Several pids can be given, for example if you want to order a book, but does not care which of the editions. Required, and only applicable to new orders when making a new order.
        example: ["870970-basis:51989252"]
        type: array
        items: {type: "string"}
      library:
        description: The library to deliver to. Required when making a new order.
        type: string
        example: "700401"
      name:
        description: The full name of the user. Required when making new order for some libraries, - check the /libraries endpoint.
        type: string
        example: Jens Jensen
      address:
        description: The address of the user. Required when making new order for some libraries, - check the /libraries endpoint.
        example: Kirkestræde 1, 1234 Landsby
        type: string
      email:
        description: The email of the user. Required when making new order for some libraries, - check the /libraries endpoint.
        example: jens.jensen@example.com
        type: string
      phone:
        description: The phone number of the user. Required when making new order for some libraries, - check the /libraries endpoint.
        example: 12345678
        type: string
      expires:
        description: When the order expires if not fullfilled. Required when making a new order.
        type: string
        example: 2016-06-24
        format: date-time
      delete:
        description: whether to delete an order, - not applicable to new orders.
        type: bool
        example: true
    response:
      example: { "pids": ["870970-basis:51989252"], "library": "700401", "expires": "2016-06-24T18:25:43.511Z"}
  recommend:
    description: Get recommendations based on a list of likes
    properties:
      filter:
        description: filter the likes by library or material type
        type: object
        properties:
          libraries: 
            description: list of libraries
            type: array
            items: {type: "string"}
            example: ["700401", "710104"]
          types: 
            description: types of materials
            type: array
            items: {type: "string"}
            example: ["artikel", "tidskriftsartikel"]
      recommender:
        description: the type of recommender, such as default or popular
        type: string
        example: default
      likes:
        description: list of liked materials
        type: array
        items: {type: "string"}
        examples: ["870970-basis:12345678", "..."]
      dislikes:
        description: list of disliked materials
        type: array
        items: {type: "string"}
        examples: ["870970-basis:12345678", "..."]
      known:
        description: list of materials that is related to the user
        type: array
        items: {type: "string"}
        examples: ["870970-basis:12345678", "..."]
      discard:
        description: list of materials that should not be returned from the recommender
        type: array
        items: {type: "string"}
        examples: ["870970-basis:12345678", "..."]
    response:
      example: [ { "title": "Harry Potter og Fønixordenen", "creator": "...", "weight": 123, "pid": "300185-katalog:100562332", "fromPid": "870970-basis:51989252"}, "..."]
  renew:
    description: Renew a material
    properties:
      loanId:
        description: id of the loan to renew
        type: string
        example: "7890"
    response:
      example: {"loanId": "7890", "returnDate": "2016-09-12"}
  search:
    description: Search for a library material.
    required:
      - q
    properties:
      q:
        example: "harry AND potter"
        description: |
           Query to search for. The query is expressed in CQL, see http://zing.z3950.org/cql/.
        type: string
      offset:
        example: 0
        description: Starting position in search result
        type: number
      limit:
        example: 10
        description: maximum number of results returned
        type: number
      fields:
        example: ["title", "creator", "pid"]
        description: which meta-information to include in the search results
        type: array
        items: {type: "string"}
      sort:
        example: "default"
        description: Order/ranking of results, such as "default", "rank_title", "rank_general", "acquisitionDate_ascending", "random"
        type: string
    response:
      type: array
      #items: {$ref: "#/definitions/Work"}
      example: [{"identifier": ["300185-katalog:100562332"], "dcTitle": ["Harry Potter og Fønixordenen DVD"], "coverUrlFull": ["https://moreinfo.addi.dk/2.1/more_info_get.php?id=36565894&type=forside_500&key=55d553c259c9e46291a4"]}, {"identifier": ["870970-basis:51989252"], "dcTitle": ["Harry Potter og de vises sten"], "collection": ["300185-katalog:100562332", "870970-basis:51989252", "870971-forfweb:86203219", "870970-basis:24284514", "870970-basis:24284565", "..."], "dcSubjectDBCF": ["fantasy", "magi", "troldmænd"], "relHasAdaption": ["870970-basis:27123279", "870970-basis:27963390"], "coverUrlFull": ["https://moreinfo.addi.dk/2.1/more_info_get.php?id=36565894&type=forside_500&key=55d553c259c9e46291a4"]}]
  suggest:
    description: Suggestions for completing a query string
    required:
      - q
    properties:
      q:
        description: Query to complete
        type: string
        example: "harry"
      limit:
        description: Maximum number of suggestions returned
        type: number
        example: 10
      type:
        description: The desired type of suggestions, possible values are `library`, `title`, `subject`, `creator`
        type: string
        example: "title"
      fields:
        description: "Fields to return, defaults to `term`. The `subject`- and `creator`-suggest only has `term`, while `title`-suggest also has `pid`, `creator`, and `type`, and the `library`-suggest has `væsensnavn`, `adresse`, `id`, `postnr`, `geolokation`, `navn`, `bibliotekstype`, and `by`. TODO: these field-names should be in english instead."
        type: array
        items: {type: "string"}
        example: ["term", "pid", "creator", "type"]
    response:
      example: [ { "term": "Harry Potter og Hemmelighedernes Kammer", "pid": "870970-basis:22375733", "creator": "Joanne K. Rowling", "type": "book"}, { "term": "Harry Potter og fangen fra Azkaban", "pid": "870970-basis:22639862", "creator": "Joanne K. Rowling", "type": "book" }]
  user:
    description: info about current logged-in user
    properties:
      fields:
        description: filter user info
        example: ["id", "registered"]
    example: {}
    response:
      example: 
        id: "U2VydmljZVByb3ZpZGVy"
        registered: true
        loans:
          loanId: "4940377131"
          pid: "870970-basis:51123455"
          title: håndbog over håndbøger
          author: La, Chris
          dueDate: "2016-04-16"
        orders: 
          orderId: "24181913"
          orderDate: "2016-01-01"
          expires: "2016-01-01"
          pid: "870970-basis:51989252"
          title: Morder-Anders og hans venner
          author: Jonasson, Jonas
          status: In process
          type: Hold
          holdQueuePosition: 14
          library: "710100"
        debt:
          amount: "20"
          currency: dkk
          date: 2015-11-21
          type: Fine
          author: Kristín Marja Baldursdóttir
          title: Kantate
  work:
    description: Retrieve meta information about a creative work
    properties:
      pids:
        description: the id of the material
        type: array
        items: {type: "string"}
        example: ["870970-basis:51989252"]
      fields:
        description: Which fields to return. Limiting the fields can also yield a performance improvement
        type: array
        items: {type: "string"}
        example: ["title", "collection", "dcSubjectDBCF", "relHasAdaptation", "coverUrlFull"]
    response:
      example: [{ "dcTitle": ["Harry Potter og de vises sten"], "collection": ["300185-katalog:100562332", "870970-basis:51989252", "870971-forfweb:86203219", "870970-basis:24284514", "870970-basis:24284565", "..."], "dcSubjectDBCF": ["fantasy", "magi", "troldmænd"], "relHasAdaption": ["870970-basis:27123279", "870970-basis:27963390"], "coverUrlFull": ["https://moreinfo.addi.dk/2.1/more_info_get.php?id=36565894&type=forside_500&key=55d553c259c9e46291a4"]}] 
definitions:
  Work:
    example: { "dcTitle": ["Harry Potter og de vises sten"], "collection": ["300185-katalog:100562332", "870970-basis:51989252", "870971-forfweb:86203219", "870970-basis:24284514", "870970-basis:24284565", "..."], "dcSubjectDBCF": ["fantasy", "magi", "troldmænd"], "relHasAdaption": ["870970-basis:27123279", "870970-basis:27963390"], "coverUrlFull": ["https://moreinfo.addi.dk/2.1/more_info_get.php?id=36565894&type=forside_500&key=55d553c259c9e46291a4"]}
    type: object
    properties:
      pid: {type: "array", items: {type: "string"}}
      collection: {type: "array", items: {type: "string"}}
      title: {type: "array", items: {type: "string"}}
      creator: {type: "array", items: {type: "string"}}
      "...": "..."
